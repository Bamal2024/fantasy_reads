{% extends "reads/base.html" %}
{% load static %} 
{% block content %}
<div class="libro-detalle-container" style="display:flex; gap:20px; margin:20px 0; flex-wrap: wrap;">
    
    <!-- Portada + Bot√≥n -->
    <div class="libro-portada" style="flex:1; min-width:250px; text-align:center;">
        {% if libro.portada %}
            <img src="{{ libro.portada.url }}" alt="{{ libro.titulo }}" class="libro-portada">
        {% else %}
            <img src="{% static 'reads/images/default-cover.jpg' %}" alt="Portada no disponible" class="libro-portada">
        {% endif %}

        <!-- Bot√≥n de comprar -->
        <div style="margin-top:15px;">
            <a href="{% url 'crear_pedido' libro.id %}" class="btn-sugerencia">
                Comprar
            </a>
        </div>
    </div>

    <!-- Detalles del libro -->
    <div class="libro-info" style="flex:2; min-width:250px;">
        <h1>{{ libro.titulo }}</h1>
        <h3>Autor: {{ libro.nombre_autor }}</h3>

        <!-- Saga -->
        <p>
            <strong>¬øEs parte de una saga?:</strong>
            {% if libro.saga %}
                ‚úÖ S√≠ ({{ libro.saga_nombre }})
            {% else %}
                ‚ùå No
            {% endif %}
        </p>

        {% if libro.saga %}
            <p><strong>Cantidad de libros en la saga:</strong> {{ libro.cantidad_saga }}</p>
            <p><strong>Saga terminada:</strong>
                {% if libro.saga_terminada %}
                    ‚úÖ S√≠
                {% else %}
                    üîÑ A√∫n en desarrollo
                {% endif %}
            </p>
        {% endif %}

        <p><strong>Fecha de publicaci√≥n:</strong> {{ libro.fecha_publicacion }}</p>
        <p><strong>Categor√≠a:</strong> {{ libro.categoria }}</p>
        <p><strong>Sinopsis:</strong> {{ libro.sinopsis }}</p>

        <!-- Precio y stock -->
        {% if libro.precio %}
            <p><strong>Precio:</strong> ${{ libro.precio }}</p>
        {% endif %}
        {% if libro.descuento %}
            <p><strong>Descuento:</strong> {{ libro.descuento }}%</p>
        {% endif %}
        {% if libro.stock %}
            <p><strong>Stock disponible:</strong> {{ libro.stock }}</p>
        {% endif %}

        <!-- Calificaci√≥n -->
        <p>
        <strong>Calificaci√≥n (Trama):</strong>
        {% if libro.calificacion_trama %}
            {% for i in ""|center:libro.calificacion_trama %}
                ‚≠ê
            {% endfor %}
        {% else %}
            ‚ùå Sin calificaci√≥n
        {% endif %}
        </p>

        <p>
        <strong>Nivel Spicy:</strong>
        {% if libro.nivel_spicy %}
            {% for i in ""|center:libro.nivel_spicy %}
                üå∂Ô∏è
            {% endfor %}
        {% else %}
                ‚ùå Sin calificaci√≥n
        {% endif %}
        </p>

        <!-- Enlace externo -->
        {% if libro.linkGoodreads %}
            <p style="margin-top:10px;">
                <a href="{{ libro.linkGoodreads }}" target="_blank" class="button-link">
                    Ver en Goodreads
                </a>
            </p>
        {% endif %}
    </div>
</div>

<!-- Libros similares (API Google Books) -->
<div class="libros-similares" style="margin-top: 40px;">
    <h2>Libros similares</h2>
    {% if similares %}
        <ul class="libros-grid">
            {% for s in similares %}
            <li class="libro-card">
                <a href="{{ s.link|default:'#' }}" target="_blank" class="libro-link">
                    
                    <!-- Imagen o imagen por defecto -->
                    {% if s.image %}
                        <img src="{{ s.image }}" alt="{{ s.title }}" class="libro-portada">
                    {% else %}
                        <img src="{% static 'reads/images/no_image_available.png' %}" alt="Imagen no disponible" class="libro-portada">
                    {% endif %}

                    <!-- T√≠tulo -->
                    <h3>{{ s.title }}</h3>

                    <!-- Autor -->
                    {% if s.author %}
                        <p style="font-size: 0.85rem; color:#ccc;">{{ s.author }}</p>
                    {% else %}
                        <p style="font-size: 0.85rem; color:#999;">Autor desconocido</p>
                    {% endif %}
                </a>
            </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No se encontraron libros similares.</p>
    {% endif %}
</div>
{% endblock %}
